<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Audio Test</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #000;
            color: #0f0;
            font-family: 'Courier New', monospace;
        }
        #container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }
        #controls {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 10;
            background: rgba(0,0,0,0.8);
            padding: 20px;
            border: 1px solid #0f0;
        }
        button {
            background: #0f0;
            color: #000;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }
        button:hover {
            background: #0ff;
        }
        #info {
            margin-top: 10px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div id="container"></div>
    <div id="controls">
        <h2>üéµ SIMPLE AUDIO TEST</h2>
        <button onclick="testStart()">‚ñ∂Ô∏è START</button>
        <button onclick="testStop()">‚èπÔ∏è STOP</button>
        <div id="info">Status: Ready</div>
    </div>

    <script>
        const AUDIO_URL = 'https://radio.freeundergroundtekno.org/listen/free_underground_tekno/radio.mp3';
        let audioContext = null;
        let audioElement = null;
        let analyser = null;
        let isPlaying = false;

        function updateInfo(msg) {
            document.getElementById('info').textContent = msg;
            console.log(msg);
        }

        async function testStart() {
            if (isPlaying) {
                updateInfo('Already playing');
                return;
            }

            try {
                updateInfo('Initializing audio...');
                
                // Create audio context
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                updateInfo('AudioContext created');
                
                // Create audio element
                audioElement = new Audio(AUDIO_URL);
                audioElement.crossOrigin = 'anonymous';
                updateInfo('Audio element created');
                
                // Create analyser
                analyser = audioContext.createAnalyser();
                analyser.fftSize = 2048;
                analyser.smoothingTimeConstant = 0.8;
                updateInfo('Analyser created');
                
                // Connect nodes
                const source = audioContext.createMediaElementSource(audioElement);
                source.connect(analyser);
                analyser.connect(audioContext.destination);
                updateInfo('Audio nodes connected');
                
                // Start playback
                await audioElement.play();
                isPlaying = true;
                updateInfo('‚úÖ PLAYING! Check console for errors');
                
                // Start animation
                animate();
                
            } catch (err) {
                updateInfo('‚ùå ERROR: ' + err.message);
                console.error('Audio error:', err);
            }
        }

        function testStop() {
            if (!isPlaying) return;
            
            if (audioElement) {
                audioElement.pause();
                audioElement.currentTime = 0;
            }
            
            isPlaying = false;
            updateInfo('‚èπÔ∏è STOPPED');
        }

        function animate() {
            if (!isPlaying) return;
            
            // Get frequency data
            const bufferLength = analyser.frequencyBinCount;
            const dataArray = new Uint8Array(bufferLength);
            analyser.getByteFrequencyData(dataArray);
            
            // Calculate bass level
            const bassSum = dataArray.slice(0, 10).reduce((a, b) => a + b, 0);
            const bassLevel = Math.round((bassSum / (10 * 255)) * 100);
            
            updateInfo(`‚úÖ PLAYING | Bass: ${bassLevel}%`);
            
            requestAnimationFrame(animate);
        }

        console.log('üöÄ Simple audio test ready');
        console.log('Click START to test audio stream');
    </script>
</body>
</html>
